<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


    <title>ElectoBuy</title>
    <style>
      *{
        overflow-x: hidden;
      }


              .switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
      }

      .switch input { 
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        -webkit-transition: .4s;
        transition: .4s;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        -webkit-transition: .4s;
        transition: .4s;
      }

      input:checked + .slider {
        background-color: #2196F3;
      }

      input:focus + .slider {
        box-shadow: 0 0 1px #2196F3;
      }

      input:checked + .slider:before {
        -webkit-transform: translateX(26px);
        -ms-transform: translateX(26px);
        transform: translateX(26px);
      }

      /* Rounded sliders */
      .slider.round {
        border-radius: 34px;
      }

      .slider.round:before {
        border-radius: 50%;
      }
      </style>
  </head>
    <body>
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand" href="adminindex.html">ElectoBuy Admin Portal</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarText">
              <ul class="navbar-nav mr-auto">
                <li class="nav-item">
                  <a class="nav-link active" href="searchuser.html">Search User</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="addstore.html">Add Store</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="addproduct.html">Add Product</a>
                </li>
      
                <li class="nav-item ">
                  <a class="nav-link" href="addstoreinventory.html">Update Inventory</a>
                </li>
              </ul>
              <span class="navbar-text">
                <a class="nav-link" href="#">Sign Out</a>
              </span>
            </div>
          </nav>

         


          <center><h2 style=" font-family: 'Anton', sans-serif; color: #5fbae9; margin-top: 20px;">ElectoBuy Store Details</h2></center>


<div id="" class="row justify-content-center">
  <div class="col-auto">
    <table class="table table-responsive">
      <table id="usersearchresulttabledetail" class="table table-striped table-responsive shadow-lg p-3 mb-5 bg-white rounded">
        <thead>
        <tr>
          <th scope="col">Store Id</th>
      <th scope="col">Store Name</th>
      <th scope="col">Store Address	</th>
      <th scope="col">Store City</th>
      <th scope="col">Store State</th>
      <th scope="col">Store Country</th>
      <th scope="col">Store Zip Code</th>
      <th scope="col">Store Phone Number</th>
        </tr>
        </thead>
        <tbody>
        
        </tbody>
        </table>
    </table>
  </div>
</div>





<div class="row justify-content-center" >
  <div class="col-auto">
    <table class="table table-responsive">
      <table  class="table table-striped table-responsive shadow-lg p-3 mb-5 bg-white rounded">
        <thead>
        <tr>
        <th class="text-center" scope="col"><h4 id="toggleswitch" style="overflow:hidden;"></h4></th>
        <th class="text-center" scope="col">
          <label class="switch" >
          <input id="test" type="checkbox" onchange="displayme()"  checked>
          <span class="slider round"></span>
        </label>
      </th>
        </tr>
        </thead>
        <tbody>
        
        </tbody>
        </table>
    </table>
  </div>
</div>






<div id="productquantity" class="row justify-content-center" >
  <div class="col-auto">
    <table class="table table-responsive">
      <table id="productquantitytable" class="table table-striped table-responsive shadow-lg p-3 mb-5 bg-white rounded">
        <thead>
        <tr>
        <th class="text-center" scope="col">Product ID</th>
        <th class="text-center" scope="col">Product Name</th>
        <th class="text-center" scope="col">Product Quantity</th>
        </tr>
        </thead>
        <tbody>
        
        </tbody>
        </table>
    </table>
  </div>
</div>








<div id="detailsection" class="row justify-content-center">
  <div class="col-auto">
    <table class="table table-responsive">
      <h4 id="orderhistorydisplaytagh4" style="display: none; font-family: 'Anton', sans-serif; color: #5fbae9;">There is no orders for this location!</h4>
      <table id="orderresulttabledetail" class="table table-striped table-responsive shadow-lg p-3 mb-5 bg-white rounded">
        <thead>
        <tr>
        <th class="text-center" scope="col">Order Id #</th>
        <th class="text-center" scope="col">Date Placed</th>
        <th class="text-center" scope="col">Customer who placed</th>
        </tr>
        </thead>
        <tbody>
        
        </tbody>
        </table>
    </table>
  </div>
</div>










    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script>

            window.addEventListener('load', function () {
              product = document.getElementById("productquantity");
              product.hidden = "true";
              toggleswitch = document.getElementById("toggleswitch");
              toggleswitch.innerHTML = "Order History";
            })

        function displayme(){

          checkbox = document.getElementById("test");
          orders = document.getElementById("detailsection");
          product = document.getElementById("productquantity");
          toggleswitch = document.getElementById("toggleswitch");

        if(checkbox.checked){
          
          toggleswitch.innerHTML = "Order History";
          product.hidden = true;
          orders.hidden = false;
          

        }
        else{
          
          toggleswitch.innerHTML = "Store Inventory";
          orders.hidden = true;
          product.hidden = false;
          
        }

        }
       

      



//fetch statement for store details

        var past_id = window.sessionStorage.getItem("storedetaillink")
        
         fetch(`/api/stores/findstorebyid/${past_id}`)
        .then(response => response.json())
        .then(store => {
              var table = document.getElementById("usersearchresulttabledetail");
              
              var row = table.insertRow(1);
              row.classList.add("table-primary");                     
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            var cell4 = row.insertCell(3);
            var cell5 = row.insertCell(4);
            var cell6 = row.insertCell(5);
            var cell7 = row.insertCell(6);
            var cell8 = row.insertCell(7);
            cell8.setAttribute("id", "cell8phonenumber");
            cell1.innerHTML = `${store.id}`;
            cell2.innerHTML = `ElectoBuy`;
            cell3.innerHTML = `${store.storeLocationAddress}`;
            cell4.innerHTML = `${store.storeLocationCity}`;
            cell5.innerHTML = `${store.storeLocationState}`;
            cell6.innerHTML = `${store.storeLocationCountry}`;
            cell7.innerHTML = `${store.storeLocationZip}`;
            cell8.innerHTML = `${store.storePhoneNumber}`;


            //fetch statement for product inventory

fetch(`https://localhost:5001/api/storesinventory/${store.storePhoneNumber}`)
      .then(response => response.json())
      .then(inventory => {
          console.log(inventory);

          var table = document.getElementById("productquantitytable");
            var divdetail = document.getElementById("productquantity");

            
              if(inventory == ""){
              
                divdetail.innerHTML = "<i class='fa fa-exclamation-triangle' aria-hidden='true'></i> &nbsp;&nbsp;" +  " No inventory for this location! Please add now!";
                
                
                divdetail.style.color = "red";
                divdetail.style.fontFamily = 'Anton sans-serif';
                divdetail.style.fontSize = '20px';
    
                

              }

        
              inventory.forEach(element => {
                var row = table.insertRow(1);
              var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);
                var cell3 = row.insertCell(2);
                cell1.classList.add("text-center");
                cell2.classList.add("text-center");
                cell3.classList.add("text-center");
                fetch(`/api/products/findproductybyid/${element.productID}`)
      .then(response => response.json())
      .then(productname => {
                
                
                    cell1.innerHTML = `${element.productID}`;
                    cell2.innerHTML = `${productname.productName}`;
                    if(element.productQuantity >= 1){
                      cell3.innerHTML = `${element.productQuantity}`;
                    }
                    else{
                      cell3.innerHTML = "Out of Stock";
                    }
                  
                  
                  })
          
    
                })
    
      })

            
            

         
          
    
          
    
    
    
      })


      
  


//fetch statement for order history

      fetch(`/api/stores/getstorehistory/${past_id}`)
      .then(response => response.json())
        .then(orderhistory => {


            var table = document.getElementById("orderresulttabledetail");
            var divdetail = document.getElementById("detailsection");

            
              if(orderhistory == ""){
              
                divdetail.innerHTML = "<i class='fa fa-exclamation-triangle' aria-hidden='true'></i> &nbsp;&nbsp;" +  " No orders for this location!";
                
                
                divdetail.style.color = "red";
                divdetail.style.fontFamily = 'Anton sans-serif';
                divdetail.style.fontSize = '20px';
    
                

              }
              orderhistory.forEach(element => {
                var row = table.insertRow(1);
              var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);
                var cell3 = row.insertCell(2);
                cell1.classList.add("text-center");
                cell2.classList.add("text-center");
                cell3.classList.add("text-center");
                
                
                    cell1.innerHTML = `${element.id}`;
                    cell2.innerHTML = `${element.date}`;
                fetch(`/api/users/getcustomerbyid/${element.customerID}`)
                .then(response => response.json())
                  .then(user => {

     
                    cell3.innerHTML = `${user.email}`;
                    
                });
               
            
              })
            
            })




    

            




    

    </script>
   
  </body>
</html>